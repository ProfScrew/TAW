version: "3"

services:
    backend:
        container_name: backend
        build: webserver/backend/
        image: backend
        ports:
        - "8080:8080"
        volumes:
            - ./webserver/backend/express:/app/backend
        depends_on:
            - mongodb
            - redis
        networks:
            - Internal
            - External
        restart: always

    # frontend_build:
    #     container_name: frontend
    #     build: webserver/frontend/
    #     image: frontend
    #     volumes:
    #     - ./webserver/frontend/angular/:/app/frontend
    #     networks:
    #         - External

    mongodb:
        container_name: mongodb
        image: mongo
        ports:
        - "27017:27017"
        volumes:
         - ./db/mongodb:/data/db
        networks:
            - Internal
        restart: always

    redis:
        container_name: redis
        image: redis:7.2.0-alpine
        ports:
        - '6379:6379'
        command: redis-server --save 20 1 --loglevel warning
        volumes: 
        - ./db/redis:/data/
        networks:
            - Internal
        restart: always
            
    reverseproxy:
        build: reverseproxy/
        image: reverseproxy
        container_name: reverseproxy
        networks:
            - Internal
            - External
        ports:
            - "80:80"
            - "443:443"
        volumes:
        - ./webserver/frontend/angular/dist/angular:/usr/share/nginx/html
        depends_on:
            # - frontend_build
            - backend
        restart: always          


networks:
    Internal:
        internal: true
    External: